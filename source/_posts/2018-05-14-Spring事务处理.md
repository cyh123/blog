---
title: Spring事务处理
comments: true
date: 2018-05-14 19:11:57
tags: Spring 事务
categories:
---

&emsp;&emsp;在讲解Spring中使用事务管理之前，首先让我们来看下什么是事务。

# 数据库事务
&emsp;&emsp;一个数据库事务通常包含了一个序列的对数据库的读/写操作。它的存在包含有以下两个目的：
1. 为数据库操作序列提供了一个从失败中恢复到正常状态的方法，同时提供了数据库即使在异常状态下仍能保持一致性的方法。
2. 当多个应用程序在并发访问数据库时，可以在这些应用程序之间提供一个隔离方法，以防止彼此的操作互相干扰。
&emsp;&emsp;当事务被提交给了DBMS（数据库管理系统），则DBMS（数据库管理系统）需要确保该事务中的所有操作都成功完成且其结果被永久保存在数据库中，如果事务中有的操作没有成功完成，则事务中的所有操作都需要被``回滚``，回到事务执行前的状态;同时，该事务对数据库或者其他事务的执行无影响，所有的事务都好像在独立的运行。

## 事务的四个特性
&emsp;&emsp;数据库事务拥有以下四个特性，习惯上被称之为ACID特性:
1. 原子性（Atomicity）：事务作为一个整体被执行，包含在其中的对数据库的操作要么全部被执行，要么都不执行。事务的操作如果成功就必须要完全应用到数据库，如果操作失败则不能对数据库有任何影响。
2. 一致性（Consistency）：事务应确保数据库的状态从一个一致状态转变为另一个一致状态。一致状态的含义是数据库中的数据应满足完整性约束。拿转账来说，假设用户A和用户B两者的钱加起来一共是5000，那么不管A和B之间如何转账，转几次账，事务结束后两个用户的钱相加起来应该还得是5000，这就是事务的一致性。
3. 隔离性（Isolation）：多个事务并发执行时，一个事务的执行不应影响其他事务的执行。当多个用户并发访问数据库时，比如操作同一张表时，数据库为每一个用户开启的事务，不能被其他事务的操作所干扰，多个并发事务之间要相互隔离。即要达到这么一种效果：对于任意两个并发的事务T1和T2，在事务T1看来，T2要么在T1开始之前就已经结束，要么在T1结束之后才开始，这样每个事务都感觉不到有其他事务在并发地执行。
4. 持久性（Durability）：持久性是指一个事务一旦被提交了，那么对数据库中的数据的改变就是永久性的，即便是在数据库系统遇到故障的情况下也不会丢失提交事务的操作。


## 事务的隔离
&emsp;&emsp;当多个线程都开启事务操作数据库中的数据时，数据库系统要能进行隔离操作，以保证各个线程获取数据的准确性，在介绍数据库提供的各种隔离级别之前，我们先看看如果不考虑事务的隔离性，会发生的几种问题：
### 脏读
### 不可重复读
### 虚读(幻读)
### 事务隔离级别
&emsp;&emsp;数据库为我们提供的四种隔离级别：
1. Serializable (串行化)：可避免脏读、不可重复读、幻读的发生
2. Repeatable read (可重复读)：可避免脏读、不可重复读的发生
3. Read committed (读已提交)：可避免脏读的发生
4. Read uncommitted (读未提交)：最低级别，任何情况都无法保证